<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<svg xmlns="http://www.w3.org/2000/svg" width="1400" height="900" viewBox="0 0 1400 900">
  <defs>
    <marker id="arrow" markerWidth="10" markerHeight="8" refX="10" refY="4" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L10,4 L0,8 z" fill="#222"/>
    </marker>
    <style>
      .title { font: 700 28px sans-serif; fill: #111; }
      .sub   { font: 500 16px sans-serif; fill: #333; }
      .hdr   { font: 700 18px sans-serif; fill: #111; }
      .txt   { font: 500 14px sans-serif; fill: #222; }
      .small { font: 500 12px sans-serif; fill: #333; }
      .box   { fill: #ffffff; stroke: #222; stroke-width: 2; rx: 18; ry: 18; }
      .zone  { fill: #f7f7f7; stroke: #444; stroke-width: 2; rx: 22; ry: 22; }
      .link  { stroke: #222; stroke-width: 2.2; fill: none; marker-end: url(#arrow); }
      .dlink { stroke: #222; stroke-width: 2.2; fill: none; stroke-dasharray: 7 6; marker-end: url(#arrow); }
      .pill  { fill: #f0f0f0; stroke: #222; stroke-width: 1.8; rx: 999; ry: 999; }
    </style>
  </defs>

  <text x="40" y="55" class="title">RTP Manager — Carrier‑Grade Zero‑Copy Streaming Architecture</text>
  <text x="40" y="85" class="sub">Kernel LKM + mmap shared buffers + ring manager + IOCTL control plane (extension points for DMA/NIC offload)</text>

  <!-- Zones -->
  <rect x="40" y="120" width="1320" height="320" class="zone"/>
  <text x="60" y="155" class="hdr">User Space (Control + RTP Application)</text>

  <rect x="40" y="470" width="1320" height="390" class="zone"/>
  <text x="60" y="505" class="hdr">Kernel Space (RTP Manager LKM + Device / Network stack)</text>

  <!-- User boxes -->
  <rect x="80" y="190" width="360" height="210" class="box"/>
  <text x="100" y="225" class="hdr">RTP Streaming App</text>
  <text x="105" y="255" class="txt">• RX Thread (UDP/RTP ingest)</text>
  <text x="105" y="280" class="txt">• TX Thread (UDP/RTP egress)</text>
  <text x="105" y="305" class="txt">• Controller Thread</text>
  <text x="105" y="330" class="txt">• Health/telemetry hooks</text>
  <text x="105" y="355" class="txt">• Rate control / pacing</text>

  <rect x="480" y="190" width="410" height="210" class="box"/>
  <text x="500" y="225" class="hdr">User‑Space API Utilities</text>
  <text x="505" y="255" class="txt">• IOCTL client (start/stop/config/stats)</text>
  <text x="505" y="280" class="txt">• mmap buffer access (zero‑copy)</text>
  <text x="505" y="305" class="txt">• Drop/jitter monitoring</text>
  <text x="505" y="330" class="txt">• Optional tracing/exporter</text>

  <rect x="930" y="200" width="390" height="190" class="box"/>
  <text x="950" y="235" class="hdr">Ops / Observability</text>
  <text x="955" y="265" class="txt">• Stats polling / watchdog</text>
  <text x="955" y="290" class="txt">• Crash dumps / logs</text>
  <text x="955" y="315" class="txt">• CI/CD firmware integration</text>
  <text x="955" y="340" class="txt">• Rollback & version gating</text>

  <!-- Kernel boxes -->
  <rect x="80" y="535" width="470" height="285" class="box"/>
  <text x="100" y="570" class="hdr">RTP Manager Kernel Module (/dev/rtp_mgr)</text>
  <text x="105" y="600" class="txt">• Char device: open/ioctl/mmap</text>
  <text x="105" y="625" class="txt">• Ring policy: FREE→READY→INUSE</text>
  <text x="105" y="650" class="txt">• Slot metadata + atomic stats</text>
  <text x="105" y="675" class="txt">• Drop control (ring full / no ready)</text>
  <text x="105" y="700" class="txt">• Extension: kernel consumer (DMA enqueue)</text>
  <text x="105" y="725" class="txt">• Extension: netlink async events (optional)</text>
  <text x="105" y="750" class="txt">• Extension: XDP/AF_XDP fast ingress (optional)</text>

  <rect x="590" y="535" width="380" height="285" class="box"/>
  <text x="610" y="570" class="hdr">Shared Memory Region</text>
  <text x="615" y="600" class="txt">• vmalloc_user() backing</text>
  <text x="615" y="625" class="txt">• remap_vmalloc_range() to user</text>
  <text x="615" y="650" class="txt">• Slot layout: [desc][payload]</text>
  <text x="615" y="675" class="txt">• Page‑aligned, fixed stride</text>
  <text x="615" y="700" class="txt">• Zero‑copy payload movement</text>

  <rect x="1010" y="535" width="350" height="130" class="box"/>
  <text x="1030" y="570" class="hdr">Network / Media I/O</text>
  <text x="1035" y="600" class="txt">• UDP socket / RTP framing</text>
  <text x="1035" y="625" class="txt">• Device driver / DMA engine*</text>

  <rect x="1010" y="690" width="350" height="130" class="box"/>
  <text x="1030" y="725" class="hdr">Hardware Offload (Optional)</text>
  <text x="1035" y="755" class="txt">• NIC Tx/Rx rings / CQEs</text>
  <text x="1035" y="780" class="txt">• DMA (scatter/gather)</text>
  <text x="1035" y="805" class="txt">• QoS / pacing / shaping</text>

  <!-- Connectors -->
  <path class="link" d="M440 295 L480 295"/>
  <text x="445" y="285" class="small">API calls</text>

  <path class="link" d="M680 400 L680 535"/>
  <text x="690" y="470" class="small">mmap (zero‑copy payload)</text>

  <path class="dlink" d="M530 340 L260 340"/>
  <text x="310" y="325" class="small">thread orchestration</text>

  <path class="link" d="M420 315 L290 535"/>
  <text x="300" y="490" class="small">IOCTL control</text>

  <path class="link" d="M930 300 L740 535"/>
  <text x="780" y="470" class="small">telemetry / stats</text>

  <path class="link" d="M970 675 L1010 600"/>
  <text x="980" y="650" class="small">RTP I/O</text>

  <path class="dlink" d="M970 740 L1010 760"/>
  <text x="985" y="735" class="small">DMA/NIC offload*</text>

  <!-- Legend -->
  <rect x="80" y="840" width="1240" height="45" class="pill"/>
  <text x="100" y="868" class="small">
    Solid arrows = implemented reference path • Dashed arrows = optional carrier-grade extensions • *hardware offload depends on platform/NIC/media engine
  </text>
</svg>
